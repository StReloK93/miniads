import{b as G}from"./Helpers-5Npp2uYL.js";import{_ as H}from"./BaseButton.vue_vue_type_script_setup_true_lang-BSbPwuoc.js";import{i as Y,c as J,F as Q,E as X}from"./vee-validate-DhO7XGXO.js";import{Z as I,a as ee,b as V,o as te,z as d}from"./FieldImage.vue_vue_type_script_setup_true_lang-LSffCfvh.js";import{c as se}from"./createLucideIcon-nACnfReH.js";import{d as $,f as _,O as g,w as k,U as M,e as i,B as f,C as ae,c as b,R as q,M as C,D as oe,K as j,g as T,A as E,G as P,E as F,a as O,F as B,h as R,V as re,o as ne,Y as ie,b as le,W as ce,a5 as me,u as pe}from"./index-BYjx1Fp_.js";import{P as ue}from"./ProductRepo-CsMfMe1b.js";import{I as y}from"./Inputs-D-qXyN6l.js";import{C as de}from"./CategoryRepo-q2-QEvKz.js";import{C as fe}from"./chevron-right-CTtI7n-s.js";import"./FieldText.vue_vue_type_script_setup_true_lang-IkUanTv2.js";import"./chevron-down-B3UqbwRp.js";const be=se("circle-check-big",[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]);const N=e=>e!==null&&!!e&&typeof e=="object"&&!Array.isArray(e);function A(e){return Number(e)>=0}function he(e){return typeof e=="object"&&e!==null}function ye(e){return e==null?e===void 0?"[object Undefined]":"[object Null]":Object.prototype.toString.call(e)}function z(e){if(!he(e)||ye(e)!=="[object Object]")return!1;if(Object.getPrototypeOf(e)===null)return!0;let t=e;for(;Object.getPrototypeOf(t)!==null;)t=Object.getPrototypeOf(t);return Object.getPrototypeOf(e)===t}function D(e,t){return Object.keys(t).forEach(a=>{if(z(t[a])&&z(e[a])){e[a]||(e[a]={}),D(e[a],t[a]);return}e[a]=t[a]}),e}function ge(e){const t=e.split(".");if(!t.length)return"";let a=String(t[0]);for(let s=1;s<t.length;s++){if(A(t[s])){a+=`[${t[s]}]`;continue}a+=`.${t[s]}`}return a}function _e(e,t){return{__type:"VVTypedSchema",async parse(s){const r=await e.safeParseAsync(s,t);if(r.success)return{value:r.data,errors:[]};const l={};return Z(r.error.issues,l),{errors:Object.values(l)}},cast(s){try{return e.parse(s)}catch{const l=L(e);return N(l)&&N(s)?D(l,s):s}},describe(s){try{if(!s)return{required:!e.isOptional(),exists:!0};const r=xe(s,e);return r?{required:!r.isOptional(),exists:!0}:{required:!1,exists:!1}}catch{return{required:!1,exists:!1}}}}}function Z(e,t){e.forEach(a=>{const s=ge(a.path.join("."));a.code==="invalid_union"&&(Z(a.unionErrors.flatMap(r=>r.issues),t),!s)||(t[s]||(t[s]={errors:[],path:s}),t[s].errors.push(a.message))})}function L(e){if(e instanceof I)return Object.fromEntries(Object.entries(e.shape).map(([t,a])=>a instanceof ee?[t,a._def.defaultValue()]:a instanceof I?[t,L(a)]:[t,void 0]))}function xe(e,t){if(!S(t))return null;if(Y(e))return t.shape[J(e)];const a=(e||"").split(/\.|\[(\d+)\]/).filter(Boolean);let s=t;for(let r=0;r<=a.length;r++){const l=a[r];if(!l||!s)return s;if(S(s)){s=s.shape[l]||null;continue}A(l)&&ve(s)&&(s=s._def.type)}return null}function K(e){return e._def.typeName}function ve(e){return K(e)===V.ZodArray}function S(e){return K(e)===V.ZodObject}const ke={class:"relative"},we={class:"overflow-y-auto inset-0 absolute no-scrollbar px-4 py-3"},je={key:0,class:"mb-1 text-sm text-(--color-text-secondary) tracking-wide"},Oe={class:"text-sm text-(--z-danger) mt-1"},Ce={class:"flex flex-col gap-3 p-4 pb-0 border-t border-(--z-border) bg-(--z-card)"},Pe=$({__name:"BaseForm",props:{inputConfigs:{},submit:{type:Function},superRefine:{type:Function}},emits:["close","submit"],setup(e,{emit:t}){const a=t,s=e,r=R(!1),l=M(()=>Object.fromEntries(s.inputConfigs.map(c=>[c.name,c.value]))),h=M(()=>{const c={};for(const m of s.inputConfigs)m.schema&&(c[m.name]=m.schema);return te(c).superRefine(s.superRefine??(()=>{}))}),x=_e(h.value),w=async c=>{r.value=!0,await s.submit(c).finally(()=>{setTimeout(()=>{r.value=!1},500)}),a("submit",c),a("close")};return(c,m)=>{const n=H;return i(),_(g(Q),{onSubmit:w,"validation-schema":g(x),initialValues:l.value,class:"grid-rows-[1fr_auto] h-full grid -mx-4"},{default:k(()=>[f("main",ke,[f("div",we,[ae(c.$slots,"inputs"),(i(!0),b(C,null,q(e.inputConfigs,o=>(i(),b(C,{key:o.name},[o.teleport_child_class?(i(),_(oe,{key:0,defer:"",to:`.${o.teleport_child_class}`},[f("main",{class:j([o.class,"child"])},[(i(),_(T(o.component),E({name:o.name},{ref_for:!0},o.props),null,16,["name"]))],2)],8,["to"])):(i(),b("div",{key:1,class:j(o.class)},[o.props?.title?(i(),b("p",je,P(o.props?.title),1)):F("",!0),f("main",{class:j(["relative",o.teleport_parent_class])},[(i(),_(T(o.component),E({name:o.name},{ref_for:!0},o.props),null,16,["name"]))],2),O(g(X),{name:o.name},{default:k(({message:p})=>[f("p",Oe,P(p),1)]),_:1},8,["name"])],2))],64))),128))])]),f("footer",Ce,[O(n,{type:"submit",class:"w-full",loading:r.value},{icon:k(()=>[O(g(be),{class:"w-5 h-5 mr-2"})]),default:k(()=>[m[0]||(m[0]=B(" E'lonni joylash ",-1))]),_:1},8,["loading"]),m[1]||(m[1]=f("p",{class:"text-xs px-4 leading-4.5 text-center text-(--z-muted-text)"}," Elon joylashtirish orqali siz foydalanish shartlariga rozilik bildirasiz. ",-1))])]),_:3},8,["validation-schema","initialValues"])}}}),Fe=[{component:y.FieldImage,name:"images",props:{multiple:!0,title:"Rasmlar"},schema:d.array(d.any()).min(1,"Kamida 1 ta rasm yuklash kerak!"),class:["mb-3"]},{component:y.FieldText,name:"title",props:{title:"Sarlavha",placeholder:"Masalan: Iphone 13 Pro Max"},schema:d.string({message:"Majburiy maydon!"}).trim().min(5,"5 ta simboldan ko'p bolishi kerak!"),class:["mb-3"]},{component:y.FieldNumber,name:"price",props:{title:"Narx",placeholder:"Masalan: 1 000 000",min:0,max:9999999999999},schema:d.coerce.number({message:"Majburiy maydon!"}).min(1,"Narx 1 dan katta bo'lishi kerak!"),class:["mb-3"],teleport_parent_class:"parent_price"},{component:y.FieldSelect,name:"price_type_id",generateProps:async function(){const{data:e}=await re.get("/price-types");this.props={options:e,value:"name",selectIcon:!1}},value:1,schema:d.number({message:"Majburiy maydon!"}),class:["w-22","absolute","top-0.5","right-0"],teleport_child_class:"parent_price"},{component:y.FieldTextarea,name:"description",props:{title:"Izoh",maxHeight:120,placeholder:"Eloningiz  haqida qo'shimcha ma'lumot"},schema:d.string({message:"Majburiy maydon!"}).trim().min(5,"5 ta simboldan ko'p bolishi kerak!"),class:["mb-3"]},{component:y.FieldMask,name:"phone",props:{title:"Telefon raqam",placeholder:"93-123-45-67",mask:"99-999-99-99",inputmode:"tel"},schema:d.string().optional().nullable()}],Ie={string:e=>{const t=d.string({message:"Majburiy maydon!"}).trim();return e?t.min(1,"To'ldirilishi shart"):t.optional().nullable().or(d.literal(""))},number:e=>{const t=d.coerce.number({message:"Majburiy maydon!"}).min(1,"Majburiy maydon!");return e?t:t.optional().nullable()},boolean:e=>{const t=d.coerce.boolean();return e?t.refine(a=>a===!0,{message:"Tanlanishi shart"}):t.default(!1)}},Me={class:"h-full"},Te={key:0,class:"h-full flex flex-col"},Ee={class:"pb-4 border-b border-(--z-border) -mx-4 px-4"},Ne={class:"flex gap-1 items-center"},ze={key:1,class:"h-full grid grid-rows-[auto_1fr]]"},We=$({__name:"CreateProductPage",setup(e){const t=le(),a=pe(),{data:s,execute:r}=ce(de.show);var l=[];const h=R(null),x=me(Fe);async function w(n){await Promise.all(x.value.map(async u=>(u.generateProps&&await u.generateProps(),u)));const o=n.parameters,p=x.value.at(-1);o.length?p.class=["mb-3"]:p.class=[];const v=o.map((u,U)=>{const W=o.length-1===U;return{component:y[u.component],name:`parameter_${u.id}`,class:W?[]:["mb-3"],props:{title:u.title,placeholder:u.placeholder,options:u.options||[]},schema:Ie[u.type](u.pivot.is_required)}});l=[...x.value,...v],setTimeout(()=>{h.value=n},100)}async function c(n){const o={title:n.title,phone:n.phone,description:n.description,price:n.price,price_type_id:n.price_type_id,category_id:t.params.categoryId,parameters:[],images:n.images};Object.keys(n).forEach(p=>{if(p.startsWith("parameter_")){const v=p.replace("parameter_","");o.parameters.push({id:v,value:n[p]})}}),await ue.store(o)}function m(){a.push({name:"create-select-category",query:{category_id:h.value?.parent_id}})}return ne(async()=>{const n=t.params.categoryId;await r(n),s.value&&w(s.value)}),(n,o)=>(i(),b("section",Me,[h.value?(i(),b("main",Te,[f("aside",Ee,[o[0]||(o[0]=f("h3",{class:"font-extrabold text-xl mb-1"},"E'lon joylash",-1)),o[1]||(o[1]=f("p",{class:"title text-xs mb-4"},"2-qadam: E'lon ma'lumotlari",-1)),f("main",Ne,[(i(!0),b(C,null,q(g(G)(h.value),(p,v)=>(i(),b("span",{key:p.id,class:"text-sm font-bold"},[v?(i(),_(g(fe),{key:0,class:"size-3 font-semibold inline"})):F("",!0),B(" "+P(p.name),1)]))),128))])]),h.value?(i(),_(Pe,{key:0,submit:c,onClose:m,onSubmit:m,"input-configs":g(l)},null,8,["input-configs"])):F("",!0)])):(i(),b("main",ze,[...o[2]||(o[2]=[ie('<aside class="flex flex-col justify-between"><main class="pb-4 border-b border-(--z-border) -mx-4 px-4"><div class="skeleton w-22 h-5 mb-4"></div><div class="skeleton w-44 h-3 mb-4"></div><div class="flex gap-2 mb-1"><span class="skeleton w-18 h-4 inline-block"></span><span class="skeleton w-18 h-4 inline-block"></span></div></main><main class="relative grow"><article class="absolute inset-0 overflow-y-auto no-scrollbar py-3"><div class="skeleton w-16 h-3 mb-2"></div><div class="skeleton aspect-video mb-4"></div><div class="skeleton w-16 h-3 mb-1"></div><div class="skeleton h-12 mb-4.5"></div><div class="skeleton w-16 h-3 mb-1"></div><div class="skeleton h-12 mb-4.5"></div><div class="skeleton w-16 h-3 mb-1"></div><div class="skeleton h-17 mb-4"></div><div class="skeleton w-16 h-3 mb-1"></div><div class="skeleton h-12 mb-4"></div></article></main><main class="border-t border-(--z-border) h-28 p-4 pb-0 flex flex-col items-center -mx-4"><div class="skeleton h-12 rounded-2xl! mb-3 w-full"></div><p class="skeleton h-3 w-4/5 mb-1"></p><p class="skeleton h-3 w-2/5 mb-1"></p></main></aside>',1)])]))]))}});export{We as default};
