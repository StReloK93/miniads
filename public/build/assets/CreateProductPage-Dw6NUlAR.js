import{_ as U}from"./BaseButton.vue_vue_type_script_setup_true_lang-CQkCLegb.js";import{i as W,c as G,F as H,E as J}from"./vee-validate-Dto7OZ4D.js";import{Z as P,a as Q,b as V,o as X,z as u}from"./FieldImage.vue_vue_type_script_setup_true_lang-C7c8621Z.js";import{c as Y}from"./createLucideIcon-BryRo1Wc.js";import{d as q,f as _,O as x,w as v,U as C,e as c,B as d,C as ee,c as b,R as te,M as F,D as se,K as w,g as I,A as M,G as T,E as z,a as O,F as ae,h as B,V as oe,o as re,a5 as ne,b as ie,W as le,a6 as ce,u as me}from"./index-DvgdEg0x.js";import{P as pe}from"./ProductRepo-7Akkqq1i.js";import{I as h}from"./Inputs-BLhQ4JdP.js";import{C as ue}from"./CategoryRepo-FJpY_oVe.js";import"./FieldText.vue_vue_type_script_setup_true_lang-CbOWQgxL.js";import"./chevron-down-CqmeufZK.js";const de=Y("circle-check-big",[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]);const E=e=>e!==null&&!!e&&typeof e=="object"&&!Array.isArray(e);function R(e){return Number(e)>=0}function fe(e){return typeof e=="object"&&e!==null}function he(e){return e==null?e===void 0?"[object Undefined]":"[object Null]":Object.prototype.toString.call(e)}function N(e){if(!fe(e)||he(e)!=="[object Object]")return!1;if(Object.getPrototypeOf(e)===null)return!0;let t=e;for(;Object.getPrototypeOf(t)!==null;)t=Object.getPrototypeOf(t);return Object.getPrototypeOf(e)===t}function $(e,t){return Object.keys(t).forEach(a=>{if(N(t[a])&&N(e[a])){e[a]||(e[a]={}),$(e[a],t[a]);return}e[a]=t[a]}),e}function be(e){const t=e.split(".");if(!t.length)return"";let a=String(t[0]);for(let s=1;s<t.length;s++){if(R(t[s])){a+=`[${t[s]}]`;continue}a+=`.${t[s]}`}return a}function ye(e,t){return{__type:"VVTypedSchema",async parse(s){const r=await e.safeParseAsync(s,t);if(r.success)return{value:r.data,errors:[]};const i={};return A(r.error.issues,i),{errors:Object.values(i)}},cast(s){try{return e.parse(s)}catch{const i=D(e);return E(i)&&E(s)?$(i,s):s}},describe(s){try{if(!s)return{required:!e.isOptional(),exists:!0};const r=ge(s,e);return r?{required:!r.isOptional(),exists:!0}:{required:!1,exists:!1}}catch{return{required:!1,exists:!1}}}}}function A(e,t){e.forEach(a=>{const s=be(a.path.join("."));a.code==="invalid_union"&&(A(a.unionErrors.flatMap(r=>r.issues),t),!s)||(t[s]||(t[s]={errors:[],path:s}),t[s].errors.push(a.message))})}function D(e){if(e instanceof P)return Object.fromEntries(Object.entries(e.shape).map(([t,a])=>a instanceof Q?[t,a._def.defaultValue()]:a instanceof P?[t,D(a)]:[t,void 0]))}function ge(e,t){if(!S(t))return null;if(W(e))return t.shape[G(e)];const a=(e||"").split(/\.|\[(\d+)\]/).filter(Boolean);let s=t;for(let r=0;r<=a.length;r++){const i=a[r];if(!i||!s)return s;if(S(s)){s=s.shape[i]||null;continue}R(i)&&_e(s)&&(s=s._def.type)}return null}function Z(e){return e._def.typeName}function _e(e){return Z(e)===V.ZodArray}function S(e){return Z(e)===V.ZodObject}const xe={class:"relative"},ve={class:"overflow-y-auto inset-0 absolute no-scrollbar px-4 py-3"},ke={key:0,class:"mb-1 text-sm text-(--color-text-secondary) tracking-wide px-2"},je={class:"text-sm text-(--z-danger) mt-1"},we={class:"flex flex-col gap-3 p-4 pb-0 border-t border-(--z-border) bg-(--z-card)"},Oe=q({__name:"BaseForm",props:{inputConfigs:{},submit:{type:Function},superRefine:{type:Function}},emits:["close","submit"],setup(e,{emit:t}){const a=t,s=e,r=B(!1),i=C(()=>Object.fromEntries(s.inputConfigs.map(l=>[l.name,l.value]))),y=C(()=>{const l={};for(const m of s.inputConfigs)m.schema&&(l[m.name]=m.schema);return X(l).superRefine(s.superRefine??(()=>{}))}),g=ye(y.value),k=async l=>{r.value=!0,await s.submit(l).finally(()=>{setTimeout(()=>{r.value=!1},500)}),a("submit",l),a("close")};return(l,m)=>{const n=U;return c(),_(x(H),{onSubmit:k,"validation-schema":x(g),initialValues:i.value,class:"grid-rows-[1fr_auto] h-full grid -mx-4"},{default:v(()=>[d("main",xe,[d("div",ve,[ee(l.$slots,"inputs"),(c(!0),b(F,null,te(e.inputConfigs,o=>(c(),b(F,{key:o.name},[o.teleport_child_class?(c(),_(se,{key:0,defer:"",to:`.${o.teleport_child_class}`},[d("main",{class:w([o.class,"child"])},[(c(),_(I(o.component),M({name:o.name},{ref_for:!0},o.props),null,16,["name"]))],2)],8,["to"])):(c(),b("div",{key:1,class:w(o.class)},[o.props?.title?(c(),b("p",ke,T(o.props?.title),1)):z("",!0),d("main",{class:w(["relative",o.teleport_parent_class])},[(c(),_(I(o.component),M({name:o.name},{ref_for:!0},o.props),null,16,["name"]))],2),O(x(J),{name:o.name},{default:v(({message:f})=>[d("p",je,T(f),1)]),_:1},8,["name"])],2))],64))),128))])]),d("footer",we,[O(n,{type:"submit",class:"w-full",loading:r.value},{icon:v(()=>[O(x(de),{class:"w-5 h-5 mr-2"})]),default:v(()=>[m[0]||(m[0]=ae(" E'lonni joylash ",-1))]),_:1},8,["loading"]),m[1]||(m[1]=d("p",{class:"text-xs px-4 leading-4.5 text-center text-(--z-muted-text)"}," Elon joylashtirish orqali siz foydalanish shartlariga rozilik bildirasiz. ",-1))])]),_:3},8,["validation-schema","initialValues"])}}}),Pe=[{component:h.FieldImage,name:"images",props:{multiple:!0,title:"Rasmlar"},schema:u.array(u.any()).min(1,"Kamida 1 ta rasm yuklash kerak!"),class:["mb-3"]},{component:h.FieldText,name:"title",props:{title:"Sarlavha",placeholder:"Masalan: Iphone 13 Pro Max"},schema:u.string({message:"Majburiy maydon!"}).trim().min(5,"5 ta simboldan ko'p bolishi kerak!"),class:["mb-3"]},{component:h.FieldNumber,name:"price",props:{title:"Narx",placeholder:"Masalan: 1 000 000",min:0,max:9999999999999},schema:u.coerce.number({message:"Majburiy maydon!"}).min(1,"Narx 1 dan katta bo'lishi kerak!"),class:["mb-3"],teleport_parent_class:"parent_price"},{component:h.FieldSelect,name:"price_type_id",generateProps:async function(){const{data:e}=await oe.get("/price-types");this.props={options:e,value:"name",selectIcon:!1}},value:1,schema:u.number({message:"Majburiy maydon!"}),class:["w-22","absolute","top-0.5","right-0"],teleport_child_class:"parent_price"},{component:h.FieldTextarea,name:"description",props:{title:"Izoh",maxHeight:120,placeholder:"Eloningiz  haqida qo'shimcha ma'lumot"},schema:u.string({message:"Majburiy maydon!"}).trim().min(5,"5 ta simboldan ko'p bolishi kerak!"),class:["mb-3"]},{component:h.FieldMask,name:"phone",props:{title:"Telefon raqam",placeholder:"93-123-45-67",mask:"99-999-99-99",inputmode:"tel"},schema:u.string().optional().nullable()}],Ce={string:e=>{const t=u.string({message:"Majburiy maydon!"}).trim();return e?t.min(1,"To'ldirilishi shart"):t.optional().nullable().or(u.literal(""))},number:e=>{const t=u.coerce.number({message:"Majburiy maydon!"}).min(1,"Majburiy maydon!");return e?t:t.optional().nullable()},boolean:e=>{const t=u.coerce.boolean();return e?t.refine(a=>a===!0,{message:"Tanlanishi shart"}):t.default(!1)}},Fe={class:"h-full"},Ie={key:0,class:"h-full flex flex-col"},Me={key:1,class:"h-full grid grid-rows-[auto_1fr]]"},Ae=q({__name:"CreateProductPage",setup(e){const t=ie(),a=me(),{data:s,execute:r}=le(ue.show);var i=[];const y=B(null),g=ce(Pe);async function k(n){await Promise.all(g.value.map(async p=>(p.generateProps&&await p.generateProps(),p)));const o=n.parameters,f=g.value.at(-1);o.length?f.class=["mb-3"]:f.class=[];const j=o.map((p,L)=>{const K=o.length-1===L;return{component:h[p.component],name:`parameter_${p.id}`,class:K?[]:["mb-3"],props:{title:p.title,placeholder:p.placeholder,options:p.options||[]},schema:Ce[p.type](p.pivot.is_required)}});i=[...g.value,...j],setTimeout(()=>{y.value=n},100)}async function l(n){const o={title:n.title,phone:n.phone,description:n.description,price:n.price,price_type_id:n.price_type_id,category_id:t.params.categoryId,parameters:[],images:n.images};Object.keys(n).forEach(f=>{if(f.startsWith("parameter_")){const j=f.replace("parameter_","");o.parameters.push({id:j,value:n[f]})}}),await pe.store(o)}function m(){a.push({name:"create-select-category",query:{category_id:y.value?.parent_id}})}return re(async()=>{const n=t.params.categoryId;await r(n),s.value&&k(s.value)}),(n,o)=>(c(),b("section",Fe,[y.value?(c(),b("main",Ie,[o[0]||(o[0]=d("aside",{class:"pb-4 border-b border-(--z-border) -mx-4 px-4"},[d("h3",{class:"font-extrabold text-xl mb-1"},"E'lon joylash"),d("p",{class:"title text-xs"},"2-qadam: E'lon ma'lumotlari")],-1)),y.value?(c(),_(Oe,{key:0,submit:l,onClose:m,onSubmit:m,"input-configs":x(i)},null,8,["input-configs"])):z("",!0)])):(c(),b("main",Me,[...o[1]||(o[1]=[ne('<aside class="flex flex-col justify-between"><main class="relative grow"><article class="absolute inset-0 overflow-y-auto no-scrollbar"><div class="skeleton w-16 h-3 mb-2"></div><div class="skeleton aspect-video mb-4"></div><div class="skeleton w-16 h-3 mb-1"></div><div class="skeleton h-12 mb-4.5"></div><div class="skeleton w-16 h-3 mb-1"></div><div class="skeleton h-12 mb-4.5"></div><div class="skeleton w-16 h-3 mb-1"></div><div class="skeleton h-17 mb-4"></div><div class="skeleton w-16 h-3 mb-1"></div><div class="skeleton h-12 mb-4"></div></article></main><main class="border-t border-(--z-border) h-28 p-4 pb-0 flex flex-col items-center -mx-4"><div class="skeleton h-12 rounded-2xl! mb-3 w-full"></div><p class="skeleton h-3 w-4/5 mb-1"></p><p class="skeleton h-3 w-2/5 mb-1"></p></main></aside>',1)])]))]))}});export{Ae as default};
