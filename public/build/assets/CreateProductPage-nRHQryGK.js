import{_ as L}from"./BaseButton.vue_vue_type_script_setup_true_lang-Vj2628ss.js";import{i as K,c as U,F as G,E as H}from"./vee-validate-B698ihBo.js";import{Z as w,a as W,b as E,o as J,z as p}from"./FieldImage.vue_vue_type_script_setup_true_lang-V515DNR3.js";import{c as Q}from"./createLucideIcon-tcSCCwuj.js";import{d as S,f as b,O as y,w as _,U as O,e as m,B as d,C as X,c as h,R as Y,M as P,D as ee,K as k,g as C,A as F,G as I,E as V,a as j,F as te,h as q,V as se,o as ae,a5 as oe,b as re,a6 as ne,u as ie}from"./index-CTwd-zWN.js";import{P as le}from"./ProductRepo-mrHZ_HtN.js";import{I as f}from"./Inputs-3ziJMnh9.js";import{C as ce}from"./CategoryRepo-DHrKi7Dt.js";import"./FieldText.vue_vue_type_script_setup_true_lang-iu9AHUo7.js";import"./chevron-down-BDpqE0mW.js";const me=Q("circle-check-big",[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]);const M=e=>e!==null&&!!e&&typeof e=="object"&&!Array.isArray(e);function B(e){return Number(e)>=0}function pe(e){return typeof e=="object"&&e!==null}function ue(e){return e==null?e===void 0?"[object Undefined]":"[object Null]":Object.prototype.toString.call(e)}function T(e){if(!pe(e)||ue(e)!=="[object Object]")return!1;if(Object.getPrototypeOf(e)===null)return!0;let t=e;for(;Object.getPrototypeOf(t)!==null;)t=Object.getPrototypeOf(t);return Object.getPrototypeOf(e)===t}function R(e,t){return Object.keys(t).forEach(a=>{if(T(t[a])&&T(e[a])){e[a]||(e[a]={}),R(e[a],t[a]);return}e[a]=t[a]}),e}function de(e){const t=e.split(".");if(!t.length)return"";let a=String(t[0]);for(let s=1;s<t.length;s++){if(B(t[s])){a+=`[${t[s]}]`;continue}a+=`.${t[s]}`}return a}function fe(e,t){return{__type:"VVTypedSchema",async parse(s){const r=await e.safeParseAsync(s,t);if(r.success)return{value:r.data,errors:[]};const l={};return $(r.error.issues,l),{errors:Object.values(l)}},cast(s){try{return e.parse(s)}catch{const l=z(e);return M(l)&&M(s)?R(l,s):s}},describe(s){try{if(!s)return{required:!e.isOptional(),exists:!0};const r=he(s,e);return r?{required:!r.isOptional(),exists:!0}:{required:!1,exists:!1}}catch{return{required:!1,exists:!1}}}}}function $(e,t){e.forEach(a=>{const s=de(a.path.join("."));a.code==="invalid_union"&&($(a.unionErrors.flatMap(r=>r.issues),t),!s)||(t[s]||(t[s]={errors:[],path:s}),t[s].errors.push(a.message))})}function z(e){if(e instanceof w)return Object.fromEntries(Object.entries(e.shape).map(([t,a])=>a instanceof W?[t,a._def.defaultValue()]:a instanceof w?[t,z(a)]:[t,void 0]))}function he(e,t){if(!N(t))return null;if(K(e))return t.shape[U(e)];const a=(e||"").split(/\.|\[(\d+)\]/).filter(Boolean);let s=t;for(let r=0;r<=a.length;r++){const l=a[r];if(!l||!s)return s;if(N(s)){s=s.shape[l]||null;continue}B(l)&&be(s)&&(s=s._def.type)}return null}function A(e){return e._def.typeName}function be(e){return A(e)===E.ZodArray}function N(e){return A(e)===E.ZodObject}const ye={class:"relative"},ge={class:"overflow-y-auto inset-0 absolute no-scrollbar px-3 pb-4"},_e={key:0,class:"mb-1 text-sm text-(--color-text-secondary) tracking-wide px-2"},xe={class:"text-sm text-(--z-danger) mt-1"},ve={class:"flex flex-col gap-3 p-4 pb-0 border-t border-(--z-border)"},ke=S({__name:"BaseForm",props:{inputConfigs:{},submit:{type:Function},superRefine:{type:Function}},emits:["close","submit"],setup(e,{emit:t}){const a=t,s=e,r=q(!1),l=O(()=>Object.fromEntries(s.inputConfigs.map(o=>[o.name,o.value]))),x=O(()=>{const o={};for(const n of s.inputConfigs)n.schema&&(o[n.name]=n.schema);return J(o).superRefine(s.superRefine??(()=>{}))}),v=fe(x.value),g=async o=>{r.value=!0,await s.submit(o).finally(()=>{setTimeout(()=>{r.value=!1},500)}),a("submit",o),a("close")};return(o,n)=>{const u=L;return m(),b(y(G),{onSubmit:g,"validation-schema":y(v),initialValues:l.value,class:"grid-rows-[1fr_auto] h-full grid -mx-3"},{default:_(()=>[d("main",ye,[d("div",ge,[X(o.$slots,"inputs"),(m(!0),h(P,null,Y(e.inputConfigs,i=>(m(),h(P,{key:i.name},[i.teleport_child_class?(m(),b(ee,{key:0,defer:"",to:`.${i.teleport_child_class}`},[d("main",{class:k([i.class,"child"])},[(m(),b(C(i.component),F({name:i.name},{ref_for:!0},i.props),null,16,["name"]))],2)],8,["to"])):(m(),h("div",{key:1,class:k(i.class)},[i.props?.title?(m(),h("p",_e,I(i.props?.title),1)):V("",!0),d("main",{class:k(["relative",i.teleport_parent_class])},[(m(),b(C(i.component),F({name:i.name},{ref_for:!0},i.props),null,16,["name"]))],2),j(y(H),{name:i.name},{default:_(({message:c})=>[d("p",xe,I(c),1)]),_:1},8,["name"])],2))],64))),128))])]),d("footer",ve,[j(u,{type:"submit",class:"w-full",loading:r.value},{icon:_(()=>[j(y(me),{class:"w-5 h-5 mr-2"})]),default:_(()=>[n[0]||(n[0]=te(" E'lonni joylash ",-1))]),_:1},8,["loading"]),n[1]||(n[1]=d("p",{class:"text-xs px-4 leading-4.5 text-center text-(--z-muted-text)"}," Elon joylashtirish orqali siz foydalanish shartlariga rozilik bildirasiz. ",-1))])]),_:3},8,["validation-schema","initialValues"])}}}),je=[{component:f.FieldImage,name:"images",props:{multiple:!0,title:"Rasmlar"},schema:p.array(p.any()).min(1,"Kamida 1 ta rasm yuklash kerak!"),class:["mb-3"]},{component:f.FieldText,name:"title",props:{title:"Sarlavha",placeholder:"Masalan: Iphone 13 Pro Max"},schema:p.string({message:"Majburiy maydon!"}).trim().min(5,"5 ta simboldan ko'p bolishi kerak!"),class:["mb-3"]},{component:f.FieldNumber,name:"price",props:{title:"Narx",placeholder:"Masalan: 1 000 000",min:0,max:9999999999999},schema:p.coerce.number({message:"Majburiy maydon!"}).min(1,"Narx 1 dan katta bo'lishi kerak!"),class:["mb-3"],teleport_parent_class:"parent_price"},{component:f.FieldSelect,name:"price_type_id",generateProps:async function(){const{data:e}=await se.get("/price-types");this.props={options:e,value:"name",selectIcon:!1}},value:1,schema:p.number({message:"Majburiy maydon!"}),class:["w-22","absolute","top-0.5","right-0"],teleport_child_class:"parent_price"},{component:f.FieldTextarea,name:"description",props:{title:"Izoh",maxHeight:120,placeholder:"Eloningiz  haqida qo'shimcha ma'lumot"},schema:p.string({message:"Majburiy maydon!"}).trim().min(5,"5 ta simboldan ko'p bolishi kerak!"),class:["mb-3"]},{component:f.FieldMask,name:"phone",props:{title:"Telefon raqam",placeholder:"93-123-45-67",mask:"99-999-99-99",inputmode:"tel"},schema:p.string().optional().nullable()}],we={string:e=>{const t=p.string({message:"Majburiy maydon!"}).trim();return e?t.min(1,"To'ldirilishi shart"):t.optional().nullable().or(p.literal(""))},number:e=>{const t=p.coerce.number({message:"Majburiy maydon!"}).min(1,"Majburiy maydon!");return e?t:t.optional().nullable()},boolean:e=>{const t=p.coerce.boolean();return e?t.refine(a=>a===!0,{message:"Tanlanishi shart"}):t.default(!1)}},Oe={class:"h-full px-3"},Pe={key:0,class:"h-full"},Ce={key:1,class:"h-full grid grid-rows-[auto_1fr]]"},Re=S({__name:"CreateProductPage",setup(e){const t=re(),a=ie();var s=[];const r=q(null),l=ne(je);async function x(o){await Promise.all(l.value.map(async c=>(c.generateProps&&await c.generateProps(),c)));const n=o.parameters,u=l.value.at(-1);n.length?u.class=["mb-3"]:u.class=[];const i=n.map((c,Z)=>{const D=n.length-1===Z;return{component:f[c.component],name:`parameter_${c.id}`,class:D?[]:["mb-3"],props:{title:c.title,placeholder:c.placeholder,options:c.options||[]},schema:we[c.type](c.pivot.is_required)}});s=[...l.value,...i],setTimeout(()=>{r.value=o},100)}async function v(o){const n={title:o.title,phone:o.phone,description:o.description,price:o.price,price_type_id:o.price_type_id,category_id:t.params.categoryId,parameters:[],images:o.images};Object.keys(o).forEach(u=>{if(u.startsWith("parameter_")){const i=u.replace("parameter_","");n.parameters.push({id:i,value:o[u]})}}),await le.store(n)}function g(){a.push({name:"create-select-category",query:{category_id:r.value?.parent_id}})}return ae(async()=>{const o=t.params.categoryId,{data:n}=await ce.show(o);n&&x(n)}),(o,n)=>(m(),h("section",Oe,[r.value?(m(),h("main",Pe,[r.value?(m(),b(ke,{key:0,submit:v,onClose:g,onSubmit:g,"input-configs":y(s)},null,8,["input-configs"])):V("",!0)])):(m(),h("main",Ce,[...n[0]||(n[0]=[oe('<aside class="flex flex-col justify-between"><main class="relative grow"><article class="absolute inset-0 overflow-y-auto no-scrollbar"><div class="skeleton w-16 h-3 mb-2"></div><div class="skeleton aspect-video mb-4"></div><div class="skeleton w-16 h-3 mb-1"></div><div class="skeleton h-12 mb-4.5"></div><div class="skeleton w-16 h-3 mb-1"></div><div class="skeleton h-12 mb-4.5"></div><div class="skeleton w-16 h-3 mb-1"></div><div class="skeleton h-17 mb-4"></div><div class="skeleton w-16 h-3 mb-1"></div><div class="skeleton h-12 mb-4"></div></article></main><main class="border-t border-(--z-border) h-28 p-4 pb-0 flex flex-col items-center -mx-4"><div class="skeleton h-12 rounded-2xl! mb-3 w-full"></div><p class="skeleton h-3 w-4/5 mb-1"></p><p class="skeleton h-3 w-2/5 mb-1"></p></main></aside>',1)])]))]))}});export{Re as default};
